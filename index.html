<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TheBitcoinX</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      text-align: center;
      padding: 2rem;
      margin: 0;
      background-color: #1a1a2e; /* Dark background for a sleek look */
      color: #e0e0e0; /* Light text color */
      transition: background-color 0.5s ease;
      line-height: 1.6;
    }

    h1 {
      font-family: 'Montserrat', sans-serif;
      color: #00bcd4; /* Accent color for the title */
      margin-bottom: 0.5rem; /* Reduced margin to fit description */
      font-size: 2.5rem;
    }

    .page-description {
      font-size: 1rem;
      color: #a0a0a0;
      margin-bottom: 1.5rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    #signal {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      font-weight: bold;
      color: #ffffff;
    }

    #lastDetails {
      margin-top: 1rem;
      font-size: 1.1rem;
      color: #b0b0b0;
    }

    #summary {
      margin-top: 2rem;
      font-size: 1.3rem;
      font-weight: bold;
      color: #00bcd4;
    }

    #info {
      text-align: left;
      margin: 1.5rem auto;
      width: 90%;
      max-width: 700px;
      background-color: #282844; /* Slightly lighter dark background for code */
      padding: 1.5rem;
      border-radius: 8px;
      color: #a0a0a0;
      white-space: pre-wrap;
      font-family: 'monospace';
      font-size: 0.9rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      overflow-x: auto; /* For responsiveness with code blocks */
    }

    .twitter-link {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #1da1f2; /* Twitter blue */
      color: white;
      text-decoration: none;
      border-radius: 25px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .twitter-link:hover {
      background-color: #0c85d0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      h1 {
        font-size: 2rem;
      }
      .page-description {
        font-size: 0.9rem;
      }
      #signal {
        font-size: 2rem;
      }
      #summary {
        font-size: 1.1rem;
      }
      #info {
        width: 95%;
        padding: 1rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }
      .page-description {
        font-size: 0.8rem;
      }
      #signal {
        font-size: 1.8rem;
      }
      #lastDetails {
        font-size: 0.9rem;
      }
      #summary {
        font-size: 1rem;
      }
      .twitter-link {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <h1>BTC-USD (15m) Scalping</h1>
  <p class="page-description">This page displays BTC/USDT buy or sell signals, the last signal, and the variation since that signal. Signals are based on the most profitable moving average cross from the last two months. We first calculate the most profitable moving average cross and then provide the signal based on that cross. You can also see the profitability of following the signals over the last thirty days.</p>

  <div id="signal">No active signals</div>

  <div id="lastDetails"></div>

  <div id="summary"></div>

  <pre id="info"></pre>

  <a href="https://x.com/X3Bitcoin" target="_blank" class="twitter-link">Follow TheBitcoinX on X</a>

  <script>
    async function fetchSignal() {
      const el = document.getElementById('signal');
      const details = document.getElementById('lastDetails');
      const summary = document.getElementById('summary');
      const info = document.getElementById('info');
      const apiUrl = window.location.origin + '/api/signal';

      try {
        const res = await fetch(apiUrl);
        console.log('Fetch to', apiUrl, 'Status:', res.status);

        if (!res.ok) {
          const text = await res.text();
          el.textContent = `API Error: HTTP ${res.status}`;
          el.style.color = 'gray';
          document.body.style.backgroundColor = '#1a1a2e';
          summary.textContent = '';
          info.textContent = text;
          details.textContent = '';
          return;
        }

        const j = await res.json();
        console.log('Payload:', j);
        info.textContent = JSON.stringify(j, null, 2);

        if (j.error) {
          el.textContent = 'API Error: ' + j.error;
          el.style.color = 'gray';
          document.body.style.backgroundColor = '#1a1a2e';
          summary.textContent = '';
          details.textContent = '';
          return;
        }

        // Current Signal
        let currentSignalText = '';
        let backgroundColor = '#1a1a2e';
        if (j.signal === 'Hold' || j.signal === 'Hold') {
          currentSignalText = 'Hold';
          el.style.color = '#666';
        } else if (j.signal === 'Buy' || j.signal === 'Buy') {
          currentSignalText = `Buy (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          backgroundColor = 'green';
          alert(`⚡ Signal: Buy`);
        } else if (j.signal === 'Sell' || j.signal === 'Sell') {
          currentSignalText = `Sell (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          backgroundColor = 'red';
          alert(`⚡ Signal: Sell`);
        }
        el.textContent = currentSignalText;
        document.body.style.backgroundColor = backgroundColor;


        // Details of the last effective signal
        if (j.lastSignalTimestamp) {
          const dt = new Date(j.lastSignalTimestamp);
          const dateStr = dt.toLocaleDateString('en-US', {
            timeZone: 'GMT'
          });
          const timeStr = dt.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false,
            timeZone: 'GMT'
          });
          const color = j.variation >= 0 ? 'green' : 'red';

          let lastSignalTypeTranslated = j.lastSignalType;
          if (j.lastSignalType === 'Hold') {
            lastSignalTypeTranslated = 'Hold';
          } else if (j.lastSignalType === 'Buy') {
            lastSignalTypeTranslated = 'Buy';
          } else if (j.lastSignalType === 'Sell') {
            lastSignalTypeTranslated = 'Sell';
          }

          details.innerHTML =
            `<div>Last signal: <strong>${lastSignalTypeTranslated}</strong></div>` +
            `<div>Date/Time: ${dateStr} ${timeStr} GMT</div>` +
            `<div>Variation: <span style="color:${color}">${j.variation.toFixed(2)}%</span></div>`;
        } else {
          details.textContent = '';
        }


        // Final Summary: short, long and monthly performance
        summary.textContent =
          `Short: ${j.short}, Long: ${j.long} — Monthly Performance: ${j.ret.toFixed(2)}%`;


      } catch (e) {
        console.error('Fetch error:', e.message);
        el.textContent = 'Connection Error';
        el.style.color = 'gray';
        document.body.style.backgroundColor = '#1a1a2e';
        summary.textContent = '';
        info.textContent = 'Fetch error: ' + e.message;
        details.textContent = '';
      }
    }


    window.addEventListener('load', () => {
      fetchSignal();
      setInterval(fetchSignal, 15 * 60 * 1000); // Changed to 15 minutes
    });
  </script>
</body>
</html>

