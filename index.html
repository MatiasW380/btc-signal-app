<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TheBitcoinX</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      text-align: center;
      padding: 2rem;
      margin: 0;
      background-color: #1a1a2e; /* Dark background for a sleek look */
      color: #e0e0e0; /* Light text color */
      transition: background-color 0.5s ease;
      line-height: 1.6;
    }

    h1 {
      font-family: 'Montserrat', sans-serif;
      color: #00bcd4; /* Accent color for the title */
      margin-bottom: 0.5rem; /* Reduced margin to fit description */
      font-size: 2.5rem;
    }

    .page-description {
      font-size: 1rem;
      color: #a0a0a0;
      margin-bottom: 1.5rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    #signal {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      font-weight: bold;
      color: #ffffff;
    }

    #lastDetails {
      margin-top: 1rem;
      font-size: 1.1rem;
      color: #b0b0b0;
    }

    #summary {
      margin-top: 2rem;
      font-size: 1.3rem;
      font-weight: bold;
      color: #00bcd4;
    }

    #info {
      text-align: left;
      margin: 1.5rem auto;
      width: 90%;
      max-width: 700px;
      background-color: #282844; /* Slightly lighter dark background for code */
      padding: 1.5rem;
      border-radius: 8px;
      color: #a0a0a0;
      white-space: pre-wrap;
      font-family: 'monospace';
      font-size: 0.9rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      overflow-x: auto; /* For responsiveness with code blocks */
    }

    .twitter-link {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #1da1f2; /* Twitter blue */
      color: white;
      text-decoration: none;
      border-radius: 25px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .twitter-link:hover {
      background-color: #0c85d0;
    }

    .twitter-feed-container {
      margin-top: 3rem;
      padding: 1.5rem;
      background-color: #282844;
      border-radius: 8px;
      width: 90%;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .twitter-feed-container h2 {
      color: #00bcd4;
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }
      h1 {
        font-size: 2rem;
      }
      .page-description {
        font-size: 0.9rem;
      }
      #signal {
        font-size: 2rem;
      }
      #summary {
        font-size: 1.1rem;
      }
      #info, .twitter-feed-container {
        width: 95%;
        padding: 1rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }
      .page-description {
        font-size: 0.8rem;
      }
      #signal {
        font-size: 1.8rem;
      }
      #lastDetails {
        font-size: 0.9rem;
      }
      #summary {
        font-size: 1rem;
      }
      .twitter-link {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <h1>BTC-USD (5m) Scalping</h1>
  <p class="page-description">This page displays BTC/USDT buy or sell signals based on the most profitable moving average cross from the last two months. We first calculate the most profitable moving average cross and then provide the signal based on that cross. You can also see the profitability of following the signals over the last thirty days.</p>

  <div id="signal">No active signals</div>

  <div id="lastDetails"></div>

  <div id="summary"></div>

  <pre id="info"></pre>

  <a href="https://x.com/X3Bitcoin" target="_blank" class="twitter-link">Follow TheBitcoinX on X</a>

  <div class="twitter-feed-container">
    <h2>Latest from @X3Bitcoin</h2>
    <p>Content for the latest publications from @X3Bitcoin would go here.</p>
    <p>To display live tweets, you'll typically need to use the X (Twitter) API or an official embed widget, which requires a more advanced setup beyond simple HTML/JS due to API rate limits and authentication.</p>
  </div>

  <script>
    async function fetchSignal() {
      const el = document.getElementById('signal');
      const details = document.getElementById('lastDetails');
      const summary = document.getElementById('summary');
      const info = document.getElementById('info');
      const apiUrl = window.location.origin + '/api/signal';

      try {
        const res = await fetch(apiUrl);
        console.log('Fetch to', apiUrl, 'Status:', res.status);

        if (!res.ok) {
          const text = await res.text();
          el.textContent = `API Error: HTTP ${res.status}`;
          el.style.color = 'gray';
          document.body.style.backgroundColor = '#1a1a2e';
          summary.textContent = '';
          info.textContent = text;
          details.textContent = '';
          return;
        }

        const j = await res.json();
        console.log('Payload:', j);
        info.textContent = JSON.stringify(j, null, 2);

        if (j.error) {
          el.textContent = 'API Error: ' + j.error;
          el.style.color = 'gray';
          document.body.style.backgroundColor = '#1a1a2e';
          summary.textContent = '';
          details.textContent = '';
          return;
        }

        // Current Signal
        if (j.signal === 'Mantener' || j.signal === 'Hold') {
          el.textContent = 'Hold';
          el.style.color = '#666';
          document.body.style.backgroundColor = '#1a1a2e';
        } else if (j.signal === 'Comprar' || j.signal === 'Buy') {
          el.textContent = `Buy (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          document.body.style.backgroundColor = 'green';
          alert(`⚡ Signal: Buy`);
        } else if (j.signal === 'Vender' || j.signal === 'Sell') {
          el.textContent = `Sell (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          document.body.style.backgroundColor = 'red';
          alert(`⚡ Signal: Sell`);
        }


        // Details of the last effective signal
        if (j.lastSignalTimestamp) {
          const dt = new Date(j.lastSignalTimestamp);
          const dateStr = dt.toLocaleDateString('en-US', {
            timeZone: 'GMT'
          }); // Changed to GMT
          const timeStr = dt.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false,
            timeZone: 'GMT'
          }); // Changed to GMT
          const color = j.variation >= 0 ? 'green' : 'red';

          details.innerHTML =
            `<div>Last signal: <strong>${j.lastSignalType === 'Mantener' ? 'Hold' : j.lastSignalType === 'Comprar' ? 'Buy' : j.lastSignalType === 'Vender' ? 'Sell' : j.lastSignalType}</strong></div>` +
            `<div>Date/Time: ${dateStr} ${timeStr} GMT</div>` + // Changed to GMT
            `<div>Variation: <span style="color:${color}">${j.variation.toFixed(2)}%</span></div>`;
        } else {
          details.textContent = '';
        }


        // Final Summary: short, long and monthly performance
        summary.textContent =
          `Short: ${j.short}, Long: ${j.long} — Monthly Performance: ${j.ret.toFixed(2)}%`;


      } catch (e) {
        console.error('Fetch error:', e.message);
        el.textContent = 'Connection Error';
        el.style.color = 'gray';
        document.body.style.backgroundColor = '#1a1a2e';
        summary.textContent = '';
        info.textContent = 'Fetch error: ' + e.message;
        details.textContent = '';
      }
    }


    window.addEventListener('load', () => {
      fetchSignal();
      setInterval(fetchSignal, 5 * 60 * 1000);
    });
  </script>
</body>
</html>
