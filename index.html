<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>BTC-USD Scalping 5m</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
      margin: 0;
      transition: background-color 0.5s ease;
    }
    #signal {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    #lastDetails {
      margin-top: 1rem;
      font-size: 1rem;
    }
    #summary {
      margin-top: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
    }
    #error {
      color: red;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>BTC-USD (5m) Scalping</h1>

  <div id="signal">Sin señales activas</div>
  <div id="lastDetails"></div>
  <div id="summary"></div>
  <div id="error"></div>

  <script>
    async function fetchSignal() {
      const el      = document.getElementById('signal');
      const details = document.getElementById('lastDetails');
      const summary = document.getElementById('summary');
      const errorEl = document.getElementById('error');
      const apiUrl  = window.location.origin + '/api/signal';

      // Limpio mensajes previos
      errorEl.textContent = '';
      summary.textContent = '';

      try {
        const res = await fetch(apiUrl);

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }

        const j = await res.json();
        if (j.error) {
          throw new Error(j.error);
        }

        // Señal actual
        if (j.signal === 'Mantener') {
          el.textContent = 'Sin señales activas';
          el.style.color = '#666';
          document.body.style.backgroundColor = '';
        } else if (j.signal === 'Comprar') {
          el.textContent = `${j.signal} (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          document.body.style.backgroundColor = 'green';
          alert(`⚡ Señal: ${j.signal}`);
        } else { // Vender
          el.textContent = `${j.signal} (SMA${j.short}/${j.long})`;
          el.style.color = 'white';
          document.body.style.backgroundColor = 'red';
          alert(`⚡ Señal: ${j.signal}`);
        }

        // Detalles de la última señal efectiva
        if (j.lastSignalTimestamp) {
          const dt = new Date(j.lastSignalTimestamp);
          const dateStr = dt.toLocaleDateString('es-AR', {
            timeZone: 'America/Argentina/Buenos_Aires'
          });
          const timeStr = dt.toLocaleTimeString('es-AR', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false,
            timeZone: 'America/Argentina/Buenos_Aires'
          });
          const color = j.variation >= 0 ? 'green' : 'red';

          details.innerHTML =
            `<div>Última señal: <strong>${j.lastSignalType}</strong></div>` +
            `<div>Fecha/hora: ${dateStr} ${timeStr} GMT-3</div>` +
            `<div>Variación: <span style="color:${color}">${j.variation.toFixed(2)}%</span></div>`;
        } else {
          details.textContent = '';
        }

        // Resumen final: short, long y rendimiento mensual
        summary.textContent =
          `Short: ${j.short}, Long: ${j.long} — Rendimiento mes: ${j.ret.toFixed(2)}%`;

      } catch (e) {
        console.error('Fetch error:', e.message);
        el.textContent = 'Error conexión';
        el.style.color = 'gray';
        document.body.style.backgr
::contentReference[oaicite:0]{index=0}
